mod bencode;
mod constants;
mod torrent;
mod tracker;
mod utils;

use std::{fs::File, io::Read};
use torrent::Torrent;

fn main() -> std::io::Result<()> {
    let path = "debian.torrent";
    let mut file = File::open(path)?;
    let mut buf = vec![];
    file.read_to_end(&mut buf)?;

    let bencode_data = bencode::decode(&buf).unwrap();
    let torrent_data = Torrent::new(bencode_data).unwrap();
    let peers = tracker::get_peers(torrent_data).unwrap();
    let tcp_connection = println!("{:?}", peers);

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    //let mut peers = tracker::Peers::new(buf).unwrap();
    //// match here
    //
    ////let peers = peers.get_peers().unwrap();
    //let peers = match peers.get_peers() {
    //    Ok(peers) => peers,
    //    Err(_) => {
    //        println!("couldn't get peers's ids");
    //        std::process::exit(1);
    //    }
    //};
    //
    //println!("list of peers {:?}", peers);
    //
    //println!("\x1b[93m////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\x1b[0m");
    //println!("\x1b[93m////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\x1b[0m");
    //println!("\x1b[93m////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\x1b[0m");
    //println!("\x1b[93m////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\x1b[0m");
    //println!("\x1b[93m////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\x1b[0m");
    //
    //let _ = download::download(peers);

    Ok(())
}
